<VirtualHost *:80>
  ServerName <%= node['hostname'] %>
  ServerAdmin <%= node['admin_email'] %>
  DocumentRoot <%= node['apache']['virtualhosts']['document_root'] %>
  RewriteEngine On
  RewriteCond %{HTTP:X-Forwarded-Proto} !=https
  RewriteCond %{REQUEST_URI} !^/health_check
  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [L]
  ErrorLog /var/log/apache2/canvas_errors.log
  LogLevel warn
  CustomLog /var/log/apache2/canvas_access.log combined
  SetEnv RAILS_ENV <%= node['environment'] %>
  <Directory <%= node['apache']['virtualhosts']['document_root'] %>>
    Options All
    AllowOverride All
    Require all granted
  </Directory>
</VirtualHost>
